<%_
	let thisMagickFlowConfig = locals.magickFlows[demoMagickFlowUrlSlugsMapToFlowDirectories[locals.urlSlug]];
_%>
<script type="text/javascript">
	const thisMagickFlowConfig =<%- JSON.stringify(thisMagickFlowConfig)%>;
	console.log('thisMagickFlowConfig', thisMagickFlowConfig);
</script>
<%_
	let showMetaDataMissingError = true;
	let thisMagickFlowMetaData = thisMagickFlowConfig.metaData;


	// marry the metaData to the screens

	
	thisMagickFlowConfig.screens.forEach(function(fileName, fileIndex) {

		// get the "stub" of the filename for each screen, if there is one, and look it up in the metaData


		const thisMagifFlowPath = magickFlows[demoMagickFlowUrlSlugsMapToFlowDirectories[locals.urlSlug]].path;
		let thisMagickFlowsSlideClassnames = {
			'magick-flows-slide': true
		};

		const thisMagickFlowScreenUrl = `/magick-flows/${demoMagickFlowUrlSlugsMapToFlowDirectories[locals.urlSlug]}/${thisMagickFlowConfig.screens[parseInt( fileIndex )]}`;
		const thisMagickFlowScreenHeaderUrl = `includes/${locals.siteSection}/${demoMagickFlowUrlSlugsMapToFlowDirectories[locals.urlSlug]}/${parseInt( fileIndex )}.header.png`;
		const thisMagickFlowScreenFooterUrl = `includes/${locals.siteSection}/${demoMagickFlowUrlSlugsMapToFlowDirectories[locals.urlSlug]}/${parseInt( fileIndex )}.footer.png`;

		let thisMagickFlowScreenCustomContentStylesMarginTop = '0px';
		try {
			thisMagickFlowScreenCustomContentStylesMarginTop = `${thisMagickFlowMetaData[fileIndex]['margin-top']}`;
		}
		catch(error) {
			// The error shown here is unhelpful, and we've trapped it nicely, so we'll just warn a friendly thing.
			if (showMetaDataMissingError === true) {
				console.warn(`
WARNING

The Magick Flow in being loaded does not appear to have an entry in the config file in \`localization.magicFlowsMetaData[locals.urlSlug]\`.

Which is fine, that file is optional, and so is inclusion in the file itself.

This is just an FYI.
				`);
				showMetaDataMissingError = false;
			}
			// console.error(error);
		}


		let thisMagickFlowScreenCustomContentStylesMarginBottom = '0px';
		try {
			thisMagickFlowScreenCustomContentStylesMarginBottom = `${thisMagickFlowMetaData[fileIndex]['margin-bottom']}`;
		}
		catch(error) {
			// console.warn(error);
		}



		const isPng = thisMagickFlowScreenUrl.endsWith('.png');
		const isSvg = thisMagickFlowScreenUrl.endsWith('.svg');
		const isMp4 = thisMagickFlowScreenUrl.endsWith('.mp4');
		const isGif = thisMagickFlowScreenUrl.endsWith('.gif');
		const isJpeg = thisMagickFlowScreenUrl.endsWith('.jpg');
		
		let showHeader = true;
		showHeader = (thisMagickFlowScreenUrl.includes('has-sticky-header'));
		if(!showHeader) {
			thisMagickFlowScreenCustomContentStylesMarginTop = 0;
		}
		thisMagickFlowsSlideClassnames['has-sticky-header'] = showHeader;

		let showFooter = true;
		showFooter = (thisMagickFlowScreenUrl.includes('has-sticky-footer'));
		if(!showFooter) {
			thisMagickFlowScreenCustomContentStylesMarginBottom = 0;
		}
		thisMagickFlowsSlideClassnames['has-sticky-footer'] = showFooter;


		
		// let dimensions = sizeOf(thisMagifFlowPath + thisMagickFlowScreenUrl);
		// console.log(dimensions.width, dimensions.height);


_%>
<div
	class="slds-hide slds-transition-hide slds-grid slds-grid_vertical magick-flows--slide-<%=fileIndex%>  <%= classnames(thisMagickFlowsSlideClassnames);%>"
	data-slide="<%=fileIndex%>"
	id="magick-flows--slide-<%=fileIndex%>"
>
<%_ if (showHeader) { _%>
	<header class="slds-col">
		<div class="magick-flows-stickey-header_container">
			<img
				id="sticky-header--slide-<%=fileIndex%>"
				class="sticky-footer "
				src="<%=thisMagickFlowScreenHeaderUrl%>"
			/>
		</div>
	</header>
<%_ } _%>


	<div
		class="slds-col"
		style="margin-top: <%=thisMagickFlowScreenCustomContentStylesMarginTop%>; margin-bottom: <%=thisMagickFlowScreenCustomContentStylesMarginBottom%>;"
	>
<%_ if (isPng || isSvg || isGif || isJpeg) { _%>
		<div
			class="slds-scrollable"
		>
			<img
				class="screenshot auto-replace is-image "
				id="screenshot--slide-<%=fileIndex%>"
				src="<%=thisMagickFlowScreenUrl%>"
				style="width: 100vw; max-width: 100vw;"
			>
		</div>
<%_ } else if (isMp4) { _%>
		<video
			autoplay
			class="auto-replace is-video "
			id="screenshot-wrapper--slide-<%=fileIndex%>"
			playsinline
			style="height: 100vh; width: auto;"
		>
			<source
				class="screenshot auto-replace "
				id="screenshot--slide-<%=fileIndex%>"
				src="<%=thisMagickFlowScreenUrl%>"
				type="video/mp4"
			>
			Your browser does not support the video tag.
		</video>
<%_ } _%>
	</div>

<%_ if (showFooter) { _%>
	<footer class="magick-flows-stickey-footer_container slds-col">
		<img
			id="sticky-footer--slide-<%=fileIndex%>"
			class="sticky-footer "
			src="<%=thisMagickFlowScreenFooterUrl%>"
		/>
	</footer>
<%_ } _%>
</div>



<%_ }); _%>
