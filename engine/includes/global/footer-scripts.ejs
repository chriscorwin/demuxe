<!-- each page automatically tries to include a javascript file of the same name -->
<% if (locals.siteSection) { %>
<script src="/javascripts/<%=locals.siteSection%>.js"></script>
<% } %>
<%

let thisMagickFlowConfig = locals.magickFlows[locals.magickFlows.urlSlugsMapToFlowDirectories[locals.urlSlug]];
let hasCustomClientSideScript = false;
let customClientSideScriptHtmlOut = ``;

console.log(`typeof thisMagickFlowConfig: `, typeof thisMagickFlowConfig);

if (typeof thisMagickFlowConfig === 'undefined') {
	// we got nothing from magick flows here...
} else {


	if (thisMagickFlowConfig.assets.length) {
		console.log('we have assets');


		const webRootPath = `/${locals.magickFlows.directoryName}/${locals.magickFlows.urlSlugsMapToFlowDirectories[locals.urlSlug]}`;
		const mainContentPath = `${webRootPath}/main/`;
		const assetsContentPath = `${webRootPath}/assets/`;

		console.log(`assetsContentPath: `, assetsContentPath);


		hasCustomClientSideScript = thisMagickFlowConfig.assets.find(k => k=='magick-flows-custom.js') === 'magick-flows-custom.js';
		if ( hasCustomClientSideScript === true ) {
			customClientSideScriptHtmlOut += `<script src="${assetsContentPath}magick-flows-custom.js"></script>`;
		}

	}
	console.log(`hasCustomClientSideScript: `, hasCustomClientSideScript);
}

if (locals.pageScripts) {
	locals.pageScripts.forEach(function(script) {
%>
		<script src="/javascripts/<%=script%>"></script>
<%
	});
}
%>

<%- customClientSideScriptHtmlOut %>

<script type="text/javascript">
	const navigatePage = ( url ) => {
		window.location.href = url;
	}

	if ( location.host === 'localhost:3000' ) {
		document.write( '<script src="http://' + ( location.host || 'localhost' )
			.split( ':' )[ 0 ] + ':35729/livereload.js?snipver=1"></' + 'script>' );
	}
</script>

<% if (locals.env !== 'local') { %>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=<%= gapixelid %>"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '<%= gapixelid %>');
</script>
<% } %>
