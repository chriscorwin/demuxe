<% const showRPDController = locals.sanitizedQueryParams.showRPDController; %>

<style>
	#RPDController {
		z-index: 999999;
	}

	#RPDController .slds-docked_container.left {
		right: unset;
	}

	.rapidDiv {
		position: absolute;
		display: block;
	}

	body.editMode .rapidDiv {
		box-shadow: 0 0 0 3px red;
		background-color: grey;
		padding: 12px;
		color: white;
		font-weight: bold;
		cursor: pointer;
	}

	body.editMode .rapidDiv.slds-hide {
		display: block !important;
		opacity: 0.3;
	}

	body.editMode .rapidDiv:hover {
		cursor: pointer;
		box-shadow: 0 0 0 3px blue;
	}

	body.editMode .rapidDiv.grabbing {
		cursor: grabbing;
	}

	.rapidDiv.blue {
		background-color: blue;
	}

	.rapidDiv.retina {
		background-size: 50%;
	}

	.rapidDiv.cover {
		background-size: cover;
	}
	</style>

<div id="RPDController" data-product-template="<%= locals.productTemplate %>" data-demo-venue="<%= locals.demoVenue %>" style="height: 500px; min-width: 615px; overflow-x: auto; <%= showRPDController ? '' : 'display: none;' %>">
	<div class="slds-docked_container">
		<section class="slds-docked-composer slds-grid slds-grid_vertical slds-is-open" style="overflow: scroll" role="dialog" aria-labelledby="dialog-heading-id-1" aria-describedby="RPDControllerForm">
			<header class="slds-docked-composer__header slds-grid slds-shrink-none" aria-live="assertive">
				<div class="slds-media slds-media_center slds-no-space">
					<div class="slds-media__figure slds-m-right_x-small">
						<span class="slds-icon_container">
<svg class="slds-icon slds-icon_small slds-icon-text-default" aria-hidden="true">
<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/icons/utility-sprite/svg/symbols.svg#layout" />
</svg>
</span>
					</div>
					<div class="slds-media__body">
						<h2 class="slds-truncate" id="dialog-heading-id-1" title="RPD Controller">RPD Controller</h2>
					</div>
				</div>
				<div class="slds-col_bump-left slds-shrink-none">
					<button id="dockLeftRPDController" class="slds-button slds-button_icon slds-button_icon" title="Dock Left">
						<svg class="slds-button__icon" aria-hidden="true">
							<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/icons/utility-sprite/svg/symbols.svg#chevronleft" />
						</svg>
						<span class="slds-assistive-text">Dock Left</span>
					</button>
					<button id="dockRightRPDController" class="slds-button slds-button_icon slds-button_icon slds-hide" title="Dock Right">
						<svg class="slds-button__icon" aria-hidden="true">
							<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/icons/utility-sprite/svg/symbols.svg#chevronright" />
						</svg>
						<span class="slds-assistive-text">Dock Right</span>
					</button>
					<button id="minimizeRPDController" class="slds-button slds-button_icon slds-button_icon" title="Minimize window">
						<svg class="slds-button__icon" aria-hidden="true">
							<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/icons/utility-sprite/svg/symbols.svg#minimize_window" />
						</svg>
						<span class="slds-assistive-text">Minimize RPD Controller</span>
					</button>
					<!-- button class="slds-button slds-button_icon slds-button_icon" title="Expand RPD Controller">
						<svg class="slds-button__icon" aria-hidden="true">
							<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/icons/utility-sprite/svg/symbols.svg#expand_alt" />
						</svg>
						<span class="slds-assistive-text">Expand RPD Controller</span>
					</button -->
					<button id="closeRPDController" class="slds-button slds-button_icon slds-button_icon" title="Close">
						<svg class="slds-button__icon" aria-hidden="true">
							<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/icons/utility-sprite/svg/symbols.svg#close" />
						</svg>
						<span class="slds-assistive-text">Close RPD Controller</span>
					</button>
				</div>
			</header>
			<div class="slds-docked-composer__body slds-docked-composer__body_form" id="RPDControllerForm">

			</div>
			<footer class="slds-docked-composer__footer slds-shrink-none slds-hidden">
				<button id="RPDControllerHomeButton" class="slds-button slds-button_neutral">Clear Selection</button>
			</footer>
		</section>
	</div>
</div>

<script src="/includes/rpd/controller.js"></script>

<script>
	console.log('<%= !showRPDController ? `RPD Controller hidden. Add ?showRPDController=true to URL to show.` : `RPD Controller visible` %>');

	<%- showRPDController ? "enableEditMode(document.getElementsByTagName('body')[0])" : '' %>

	const RPDController = document.getElementById('RPDController');

	showHomeForm(RPDController);

	document.querySelector('#RPDControllerHomeButton').addEventListener('click', () => {
		showHomeForm(RPDController);
	});

	document.querySelector('#closeRPDController').addEventListener('click', () => {
		showHide(RPDController, document.getElementsByTagName('body')[0]);
	});
	document.querySelector('#minimizeRPDController').addEventListener('click', () => {
		toggleOpen(document.querySelector('#RPDController > div > section').classList);
	});
	document.querySelector('#dockLeftRPDController').addEventListener('click', () => {
		document.querySelector('#dockLeftRPDController').classList.add('slds-hide');
		document.querySelector('#dockRightRPDController').classList.remove('slds-hide');
		document.querySelector('#RPDController > .slds-docked_container').style.right = "unset";
	});
	document.querySelector('#dockRightRPDController').addEventListener('click', () => {
		document.querySelector('#dockLeftRPDController').classList.remove('slds-hide');
		document.querySelector('#dockRightRPDController').classList.add('slds-hide');
		document.querySelector('#RPDController > .slds-docked_container').style.right = "0";
	});

	const addListener = () => {
		console.log('KONAMI CODE LISTENER ACTIVE. To deactivate, add ?disableKonami=true to URL. UP UP DOWN DOWN LEFT RIGHT LEFT RIGHT B A to show/hide RPD Controller');
		let cursor = 0;
		const KONAMI_CODE = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
		document.addEventListener('keydown', (e) => {
			cursor = (e.keyCode == KONAMI_CODE[cursor]) ? cursor + 1 : 0;
			if (cursor == KONAMI_CODE.length) {
				showHide(RPDController, document.getElementsByTagName('body')[0]);
				cursor = 0;
			};
		});
	}

	<% if (!locals.sanitizedQueryParams.disableKonami) { %>
		addListener();
	<% } else { %>
		console.log('KONAMI CODE LISTENER DISABLED.');
	<% } %>

	document.querySelectorAll('.rapidDiv').forEach((rpdDiv) => {
		updatePositionData(rpdDiv);
		addListeners(rpdDiv, RPDController);
	});

</script>